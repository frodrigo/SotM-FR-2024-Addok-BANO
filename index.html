<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <title>G√©ocoder effectivement avec BANO et Addok</title>
    <link rel="shortcut icon" href="./favicon.ico" />
    <link rel="stylesheet" href="./dist/reset.css" />
    <link rel="stylesheet" href="./dist/reveal.css" />
    <link rel="stylesheet" href="./dist/theme/white.css" id="theme" />
    <link rel="stylesheet" href="./css/highlight/base16/zenburn.css" />

    <link rel="stylesheet" href="./_assets/style.css" />
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section data-markdown data-separator="\r?\n---\r?\n" data-separator-vertical="\r?\n----\r?\n">
          <textarea data-template>
            

### G√©ocoder effectivement avec
# BANO et Addok

### SotM FR 2024

Fr√©d√©ric Rodrigo - Cartoway

frederic@cartoway.com

---

# Geocodons !

- Oui mais avec la BANO
  - Le meilleur des deux mondes ?
- Avant d'aller sur le terrain
  - Qualit√© et niveau de confiance tr√®s importantes

---

# [Addok](https://github.com/addok/addok)

API de g√©ocodage

- Indexer les adresses
- Recherche & autocompl√©tion plein texte
  - score : similarit√© entre recherch√© et trouv√©
- Support de plugins

----

## Plugins par d√©faut

```python
PROCESSORS_PYPATHS = [
"addok.helpers.text.tokenize",
"addok.helpers.text.normalize",
"addok_france.glue_ordinal",
"addok_france.fold_ordinal",
"addok_france.flag_housenumber",
"addok.helpers.text.synonymize",
"addok_fr.phonemicize",
]
QUERY_PROCESSORS_PYPATHS = [
'addok.helpers.text.check_query_length',
'addok_france.extract_address',
'addok_france.clean_query',
'addok_france.remove_leading_zeros',
]
SEARCH_RESULT_PROCESSORS_PYPATHS = [
"addok.helpers.results.match_housenumber",
"addok.helpers.results.score_by_importance",
"addok.helpers.results.score_by_autocomplete_distance",
"addok.helpers.results.score_by_ngram_distance",
"addok.helpers.results.score_by_geo_distance",
]
```

---

## 1 Addok, 1 Langue, 1 Pays

Sp√©cificit√©s :
- Format de l'adresse
- Langue : synonyme, nettoyage
- Phon√©tisation

----

## France

- [addok_france_clean](https://github.com/cartoway/addok_france_clean) R√®gles suppl√©mentaires de nettoyage de la recherche
  - <del>porte</del>, <del>√©tage</del>, <del>burreau</del>...
- [addok_usage_name_BAN_FR](https://github.com/cartoway/addok_usage_name_BAN_FR) Ne pas p√©naliser les versions courtes des noms de ville
  - `Brive-la-Gaillarde` = `Brive`

- Plus [conversion au format Addok+BAN](https://github.com/cartoway/geocoder-api/blob/master/docker/builder/initialize-fr.sh) de la BANO
  - type BAN != type BANO
    - (city‚û°municipality, town‚û°municipality, village‚û°municipality, place‚û°locality...)

----

## Espagne

Alternatives aux plugins France/Fran√ßais pour l'Espagne/l'espagnol(+basque+catalan+galicien)
- [addok-es](https://github.com/cartoway/addok-es) Espagnol
- [addok-spain](https://github.com/cartoway/addok-spain) Espagne
- Plus [conversion au format Addok+BAN](https://github.com/cartoway/geocoder-api/blob/master/docker/builder/initialize-es.sh) de la base d'adresse de l'Espagne

----

## Luxembourg

Alternatives aux plugins France/fran√ßais pour le Luxembourg/<del>luxembourgeois</del>
- [addok_luxemburg](https://github.com/cartoway/addok_luxemburg)
- [addok_luxemburg_clean](https://github.com/cartoway/addok_luxemburg_clean)
- [addok_usage_name_LU](https://github.com/cartoway/addok_usage_name_LU)
- Plus [conversion au format Addok+BAN](https://github.com/cartoway/geocoder-api/blob/master/docker/builder/initialize-lu.sh) de la base d'adresse du Luxembourg

---

## G√©ocodage d'adresses structur√©s

üí° Profiter de la segmentation pour am√©liorer le r√©sultat

----

## Plugin [addok_search2steps](https://github.com/cartoway/addok_search2steps)

- Recherche la commune et le code postal
- Pour chaque r√©sultat
  - Recherche le num√©ro et la rue dans cette commune
  - ‚û° Force la coh√©rence du r√©sultat
  - ‚û° Ne garder que la ville si la voie non retrouv√©e
- √Ä d√©faut : recherche classique plein texte, minor√©

----

## Plugin : Score faux n√©gatifs

[addok_score_preprocessed_query](https://github.com/cartoway/addok_score_preprocessed_query)

- √âviter les scores faussement faibles
- Scorer les r√©sultats avec la cha√Æne de recherche nettoy√© et non celle d'origine.

---

# Noms multiples

![https://social.numerique.gouv.fr/@adressedatagouv/112535272731408464](include/2ff8a2e471e92303.jpg)

----

## Noms multiples

G√©ocoder = retrouver l'adresse

- m√™me si c'est l'ancien nom de la voie ou de la commune
- m√™me si la voie √† plusieurs noms
- ...

----

## Noms multiples

Sauf que la doctrine Addok & BAN / BANO

1 voie = 1 nom

- Support multi-noms dans Addok
  - ‚û° d√©doubler les lignes
- Support multi-noms dans BANO ?

----

## Noms multiples dans BANO

Objectifs diff√©rents
- BANO : 1 nom, valider cho√©rence OSM ‚¨å BAN/Cadastre...
- G√©ocodage : retrouver une addresse depuis tous les noms possibles

‚û° alors on forke (gentiment) !

----

# Breaking news !
## Noms multiples dans les BAL

[Les BAL passent en multilingue](https://social.numerique.gouv.fr/@adressedatagouv/112535272731408464)

[Bient√¥t la BAN √©galement en multilingue](https://github.com/BaseAdresseNationale/ban-plateforme/issues/408)

---

# Contribuer √† BANO

Difficult√© de contribuer √† titre pro √† un projet communautaire quasi uni-personnel.

Diff√©rence de rapport au temps disponible et m√©thode de travail.

----

## Ex√©cuter BANO

Difficult√©s de monter une nouvelle instance BANO pour un projet dont il n‚Äôexiste qu'une seule instance.

- Manque de documentation
- Besoin de faciliter le setup

----

## Proposition d'am√©lioration

- Fix pour pouvoir lancer BANO de bout en bout
- Stopper les scripts bash et SQL √† la premi√®re erreur rencontr√©e
- Ex√©cution que sur une partie des d√©partements

----

## Proposition de changements

- Base de donn√©es : passer de 2 √† 1
- Docker : pour faciliter l'installation et la prise en main
- Python : passer d'un module √† installer √† un script
- Proc√©dure d'ex√©cution de bout en bout

----

## alors on forke (gentiment)

‚û° tout √ßa d√©j√† fait sur un [fork](https://github.com/frodrigo/bano/tree/docker)

- Cr√©ation de pull requests pour am√©liorer le projet
  - [PR](https://github.com/osm-fr/bano/pulls) en cours sur les modifications les plus basiques
- Avant de pouvoir proposer des modifications plus importantes
  - Difficult√© d'int√©gration : rapport pro / b√©n√©vole
  - Probl√©matique de maintien d'un fork en parall√®le

----

## proposition d'am√©lioration (divergente)

‚û° d√©j√† fait sur le fork

(tout √ßa pour √ßa)

- support des noms alternatifs et multilingues
  - ex : old_name, alt_name, name:eu...

----

## BANO et au de l√†
### La BA√èO¬†?

- S√©parer l‚Äôextraction des adresses OSM du rapprochement BAN/Cadastre
  - Rapprocher d'autres bases d'adresses

---

### G√©ocoder effectivement avec
# BANO et Addok

- [Plugins Addok](https://github.com/orgs/cartoway/repositories?q=addok)
  - Am√©lioration du g√©ocodage
  - Support des adresses structur√©es
  - Support du Luxembourg et de l'Espagne
- [BANO multi-noms et avec Docker](https://github.com/frodrigo/bano/tree/docker)

          </textarea>
        </section>
      </div>
    </div>

    <script src="./dist/reveal.js"></script>

    <script src="./mermaid/dist/mermaid.min.js"></script>

    <script src="./plugin/markdown/markdown.js"></script>
    <script src="./plugin/highlight/highlight.js"></script>
    <script src="./plugin/zoom/zoom.js"></script>
    <script src="./plugin/notes/notes.js"></script>
    <script src="./plugin/math/math.js"></script>
    <script>
      function extend() {
        var target = {};
        for (var i = 0; i < arguments.length; i++) {
          var source = arguments[i];
          for (var key in source) {
            if (source.hasOwnProperty(key)) {
              target[key] = source[key];
            }
          }
        }
        return target;
      }

      // default options to init reveal.js
      var defaultOptions = {
        controls: true,
        progress: true,
        history: true,
        center: true,
        transition: 'default', // none/fade/slide/convex/concave/zoom
        slideNumber: true,
        highlight: {
          highlightOnLoad: false
        },
        plugins: [
          RevealMarkdown,
          RevealHighlight,
          RevealZoom,
          RevealNotes,
          RevealMath
        ]
      };

      // options from URL query string
      var queryOptions = Reveal().getQueryHash() || {};

      var options = extend(defaultOptions, {"controls":true,"progress":true,"_":["./Geocoding.md","./node_modules/elkjs/LICENSE.md","./node_modules/micromark-util-classify-character/readme.md","./node_modules/function-bind/.github/SECURITY.md","./node_modules/function-bind/CHANGELOG.md","./node_modules/cytoscape/.github/SECURITY.md","./node_modules/cytoscape/.github/workflows/md/blog-issue-template.md","./node_modules/cytoscape/.github/workflows/md/repo-setup.md","./node_modules/cytoscape/.github/workflows/md/Patch_Backport_Release.md","./node_modules/cytoscape/.github/workflows/md/Manual_Release.md","./node_modules/cytoscape/.github/workflows/md/Feature_Release.md","./node_modules/cytoscape/.github/PULL_REQUEST_TEMPLATE.md","./node_modules/cytoscape/.github/ISSUE_TEMPLATE/bug_report.md","./node_modules/cytoscape/.github/ISSUE_TEMPLATE/feature_request.md","./node_modules/cytoscape/.github/ISSUE_TEMPLATE/backport.md","./node_modules/cytoscape/CODE_OF_CONDUCT.md","./node_modules/finalhandler/SECURITY.md","./node_modules/finalhandler/HISTORY.md","./node_modules/finalhandler/node_modules/debug/CHANGELOG.md","./node_modules/finalhandler/node_modules/ms/readme.md","./node_modules/finalhandler/node_modules/ms/license.md","./node_modules/gopd/CHANGELOG.md","./node_modules/merge-descriptors/HISTORY.md","./node_modules/quick-lru/readme.md","./node_modules/write-file-atomic/CHANGELOG.md","./node_modules/micromark-factory-space/readme.md","./node_modules/micromark-util-chunked/readme.md","./node_modules/cli-boxes/readme.md","./node_modules/depd/History.md","./node_modules/depd/Readme.md","./node_modules/string-width-cjs/readme.md","./node_modules/string-width-cjs/node_modules/strip-ansi/readme.md","./node_modules/string-width-cjs/node_modules/ansi-regex/readme.md","./node_modules/methods/HISTORY.md","./node_modules/micromark-util-symbol/readme.md","./node_modules/toidentifier/HISTORY.md","./node_modules/unique-string/readme.md","./node_modules/update-notifier/readme.md","./node_modules/update-notifier/node_modules/chalk/readme.md","./node_modules/responselike/readme.md","./node_modules/mime-db/HISTORY.md","./node_modules/commander/Readme.md","./node_modules/commander/CHANGELOG.md","./node_modules/micromark-factory-destination/readme.md","./node_modules/micromark-util-sanitize-uri/readme.md","./node_modules/ansi-align/CHANGELOG.md","./node_modules/ansi-align/node_modules/string-width/readme.md","./node_modules/ansi-align/node_modules/strip-ansi/readme.md","./node_modules/ansi-align/node_modules/ansi-regex/readme.md","./node_modules/vary/HISTORY.md","./node_modules/string-width/readme.md","./node_modules/crypto-random-string/readme.md","./node_modules/crypto-random-string/node_modules/type-fest/readme.md","./node_modules/jackspeak/LICENSE.md","./node_modules/deep-extend/CHANGELOG.md","./node_modules/etag/HISTORY.md","./node_modules/body-parser/SECURITY.md","./node_modules/body-parser/HISTORY.md","./node_modules/body-parser/node_modules/debug/CHANGELOG.md","./node_modules/body-parser/node_modules/ms/readme.md","./node_modules/body-parser/node_modules/ms/license.md","./node_modules/minimist/CHANGELOG.md","./node_modules/@pnpm/npm-conf/readme.md","./node_modules/define-lazy-prop/readme.md","./node_modules/uvu/readme.md","./node_modules/type-fest/readme.md","./node_modules/has-symbols/CHANGELOG.md","./node_modules/parseurl/HISTORY.md","./node_modules/micromark-util-decode-numeric-character-reference/readme.md","./node_modules/is-docker/readme.md","./node_modules/unist-util-stringify-position/readme.md","./node_modules/serve-favicon/HISTORY.md","./node_modules/serve-favicon/node_modules/ms/readme.md","./node_modules/serve-favicon/node_modules/ms/license.md","./node_modules/escape-goat/readme.md","./node_modules/on-finished/HISTORY.md","./node_modules/serve-static/HISTORY.md","./node_modules/bytes/History.md","./node_modules/bytes/Readme.md","./node_modules/p-cancelable/readme.md","./node_modules/open/readme.md","./node_modules/hasown/CHANGELOG.md","./node_modules/shebang-command/readme.md","./node_modules/mimic-response/readme.md","./node_modules/micromark-util-normalize-identifier/readme.md","./node_modules/dequal/readme.md","./node_modules/cookie/SECURITY.md","./node_modules/cookie/HISTORY.md","./node_modules/negotiator/HISTORY.md","./node_modules/package-json/readme.md","./node_modules/micromark-util-combine-extensions/readme.md","./node_modules/import-lazy/readme.md","./node_modules/binary-extensions/readme.md","./node_modules/is-binary-path/readme.md","./node_modules/default-browser-id/readme.md","./node_modules/@braintree/sanitize-url/CHANGELOG.md","./node_modules/micromark-factory-label/readme.md","./node_modules/which/CHANGELOG.md","./node_modules/micromark-util-html-tag-name/readme.md","./node_modules/yaml-front-matter/LICENSE.md","./node_modules/yaml-front-matter/CHANGELOG.md","./node_modules/yaml-front-matter/node_modules/commander/Readme.md","./node_modules/yaml-front-matter/node_modules/commander/CHANGELOG.md","./node_modules/yaml-front-matter/node_modules/js-yaml/CHANGELOG.md","./node_modules/yaml-front-matter/node_modules/argparse/CHANGELOG.md","./node_modules/cookie-signature/History.md","./node_modules/cookie-signature/Readme.md","./node_modules/is-inside-container/readme.md","./node_modules/katex/node_modules/commander/Readme.md","./node_modules/micromark-util-character/readme.md","./node_modules/registry-auth-token/CHANGELOG.md","./node_modules/decompress-response/readme.md","./node_modules/decompress-response/node_modules/mimic-response/readme.md","./node_modules/shebang-regex/readme.md","./node_modules/object-inspect/CHANGELOG.md","./node_modules/qs/LICENSE.md","./node_modules/qs/CHANGELOG.md","./node_modules/forwarded/HISTORY.md","./node_modules/sade/readme.md","./node_modules/path-to-regexp/History.md","./node_modules/path-to-regexp/Readme.md","./node_modules/get-intrinsic/CHANGELOG.md","./node_modules/bundle-name/readme.md","./node_modules/configstore/readme.md","./node_modules/dot-prop/readme.md","./node_modules/escape-html/Readme.md","./node_modules/xdg-basedir/readme.md","./node_modules/strip-ansi/readme.md","./node_modules/micromark-factory-whitespace/readme.md","./node_modules/decode-named-character-reference/readme.md","./node_modules/has-property-descriptors/CHANGELOG.md","./node_modules/is-obj/readme.md","./node_modules/uuid/CONTRIBUTING.md","./node_modules/uuid/LICENSE.md","./node_modules/uuid/CHANGELOG.md","./node_modules/path-scurry/LICENSE.md","./node_modules/express/History.md","./node_modules/express/Readme.md","./node_modules/express/node_modules/debug/CHANGELOG.md","./node_modules/express/node_modules/ms/readme.md","./node_modules/express/node_modules/ms/license.md","./node_modules/content-type/HISTORY.md","./node_modules/highlight.js/VERSION_11_UPGRADE.md","./node_modules/highlight.js/CHANGES.md","./node_modules/highlight.js/SUPPORTED_LANGUAGES.md","./node_modules/highlight.js/SECURITY.md","./node_modules/highlight.js/VERSION_10_UPGRADE.md","./node_modules/semver-diff/readme.md","./node_modules/micromark-util-encode/readme.md","./node_modules/diff/CONTRIBUTING.md","./node_modules/diff/release-notes.md","./node_modules/@sindresorhus/is/readme.md","./node_modules/khroma/readme.md","./node_modules/cacheable-request/node_modules/get-stream/readme.md","./node_modules/boxen/readme.md","./node_modules/boxen/node_modules/chalk/readme.md","./node_modules/ansi-regex/readme.md","./node_modules/iconv-lite/Changelog.md","./node_modules/range-parser/HISTORY.md","./node_modules/dayjs/CHANGELOG.md","./node_modules/es-define-property/CHANGELOG.md","./node_modules/call-bind/CHANGELOG.md","./node_modules/send/SECURITY.md","./node_modules/send/HISTORY.md","./node_modules/send/node_modules/debug/CHANGELOG.md","./node_modules/send/node_modules/debug/node_modules/ms/readme.md","./node_modules/send/node_modules/debug/node_modules/ms/license.md","./node_modules/send/node_modules/ms/readme.md","./node_modules/send/node_modules/ms/license.md","./node_modules/proxy-addr/HISTORY.md","./node_modules/mustache/CHANGELOG.md","./node_modules/mime/CHANGELOG.md","./node_modules/normalize-url/readme.md","./node_modules/camelcase/readme.md","./node_modules/set-function-length/CHANGELOG.md","./node_modules/micromark-util-subtokenize/readme.md","./node_modules/unpipe/HISTORY.md","./node_modules/mdast-util-from-markdown/readme.md","./node_modules/kleur/readme.md","./node_modules/character-entities/readme.md","./node_modules/path-key/readme.md","./node_modules/accepts/HISTORY.md","./node_modules/registry-url/readme.md","./node_modules/micromark-util-decode-string/readme.md","./node_modules/balanced-match/LICENSE.md","./node_modules/lodash-es/release.md","./node_modules/wrap-ansi/readme.md","./node_modules/wrap-ansi/node_modules/ansi-styles/readme.md","./node_modules/is-installed-globally/readme.md","./node_modules/d3-dsv/node_modules/iconv-lite/Changelog.md","./node_modules/mri/readme.md","./node_modules/mri/license.md","./node_modules/micromark-util-resolve-all/readme.md","./node_modules/is-path-inside/readme.md","./node_modules/side-channel/CHANGELOG.md","./node_modules/lowercase-keys/readme.md","./node_modules/jsonfile/CHANGELOG.md","./node_modules/micromark-util-types/readme.md","./node_modules/ms/readme.md","./node_modules/ms/license.md","./node_modules/content-disposition/HISTORY.md","./node_modules/is-npm/readme.md","./node_modules/wrap-ansi-cjs/readme.md","./node_modules/wrap-ansi-cjs/node_modules/ansi-styles/readme.md","./node_modules/wrap-ansi-cjs/node_modules/string-width/readme.md","./node_modules/wrap-ansi-cjs/node_modules/color-convert/CHANGELOG.md","./node_modules/wrap-ansi-cjs/node_modules/strip-ansi/readme.md","./node_modules/wrap-ansi-cjs/node_modules/ansi-regex/readme.md","./node_modules/micromark-core-commonmark/readme.md","./node_modules/default-browser/readme.md","./node_modules/json5/LICENSE.md","./node_modules/strip-json-comments/readme.md","./node_modules/has-proto/CHANGELOG.md","./node_modules/mime-types/HISTORY.md","./node_modules/strip-ansi-cjs/readme.md","./node_modules/strip-ansi-cjs/node_modules/ansi-regex/readme.md","./node_modules/latest-version/readme.md","./node_modules/widest-line/readme.md","./node_modules/statuses/HISTORY.md","./node_modules/got/readme.md","./node_modules/got/node_modules/get-stream/readme.md","./node_modules/ts-dedent/HISTORY.md","./node_modules/run-applescript/readme.md","./node_modules/is-fullwidth-code-point/readme.md","./node_modules/mermaid/README.zh-CN.md","./node_modules/is-typedarray/LICENSE.md","./node_modules/micromark-factory-title/readme.md","./node_modules/lodash/release.md","./node_modules/picomatch/CHANGELOG.md","./node_modules/raw-body/SECURITY.md","./node_modules/raw-body/HISTORY.md","./node_modules/global-dirs/readme.md","./node_modules/define-data-property/CHANGELOG.md","./node_modules/media-typer/HISTORY.md","./node_modules/pupa/readme.md","./node_modules/fresh/HISTORY.md","./node_modules/cross-spawn/CHANGELOG.md","./node_modules/safer-buffer/Readme.md","./node_modules/safer-buffer/Porting-Buffer.md","./node_modules/form-data-encoder/readme.md","./node_modules/encodeurl/HISTORY.md","./node_modules/es-errors/CHANGELOG.md","./node_modules/type-is/HISTORY.md","./node_modules/yargs-parser/CHANGELOG.md","./node_modules/is-in-ci/readme.md","./node_modules/http-errors/HISTORY.md","./node_modules/mdast-util-to-string/readme.md","./node_modules/micromark/readme.md","./node_modules/is-wsl/readme.md","./node_modules/glob-parent/CHANGELOG.md"],"static":"build","theme":"white"}, queryOptions);
    </script>


    <script>
      Reveal.initialize(options);
      Reveal.addEventListener('ready', function (event) {
        const blocks = Reveal.getRevealElement().querySelectorAll('pre code:not(.mermaid)');
        const hlp = Reveal.getPlugin('highlight');
        blocks.forEach(hlp.highlightBlock);
      });
    </script>

    <script>
      const mermaidOptions = extend({ startOnLoad: false }, {});
      mermaid.startOnLoad = false;
      mermaid.initialize(mermaidOptions);
      const cb = function (event) { mermaid.init(mermaidOptions, '.stack.present>.present pre code.mermaid'); };
      Reveal.addEventListener('ready', cb);
      Reveal.addEventListener('slidetransitionend', cb);
    </script>
  </body>
</html>
